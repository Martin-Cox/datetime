(function(a,b){if('function'==typeof define&&define.amd)define([],b);else if('undefined'!=typeof exports)b();else{b(),a.datetime={exports:{}}.exports}})(this,function(){'use strict';(function(a,b,d,f){function g(H,I){this.$element=H,this.element=H[0],this.currentSpareIndex=0,this.spares=[],this._handleMouseDown=this._handleMouseDown.bind(this),this._handleKeydown=this._handleKeydown.bind(this),this._handleMousewheel=this._handleMousewheel.bind(this),this._init(),this.setOptions(Object.assign({},G,I))}var E=8.64e7,F='datetime',G={datetime:NaN,locale:navigator.language,format:'dd.MM.yyyy HH:mm:ss',minDate:NaN,maxDate:NaN,minTime:NaN,maxTime:NaN};g.prototype={_init:function(){this.element.setSelectionRange(0,0),this.element.addEventListener('mouseup',this._handleMouseDown),this.element.addEventListener('keydown',this._handleKeydown),this.element.addEventListener('mousewheel',this._handleMousewheel)},_refresh:function(){this.spares=this._disassembleTimestamp(this.datetime,this.options.locale,this.options.format),this.element.value=this.spares.map(function(J){return J.strval}).join('');var I=this.spares[this.currentSpareIndex];I&&this.element.setSelectionRange(I.offset,I.offset+I.length)},_handleMouseDown:function(I){I.preventDefault(),I.stopPropagation(),this.currentSpareIndex=this._calculateSpareIndexAtCaretPosition(I.target.selectionStart,this.spares);var J=this.spares[this.currentSpareIndex];I.target.focus();J&&I.target.setSelectionRange(J.offset,J.offset+J.length)},_ensureValueExist:function(){return this.spares.length||(this.datetime=new Date,this._refresh()),this.spares[this.currentSpareIndex]},_handleKeydown:function(I){var J=this._ensureValueExist();switch(I.which){case 37:I.preventDefault(),this.currentSpareIndex=this._calculateNextSpareIndex(this.spares,this.currentSpareIndex,-1,function(K){return'Delimiter'!==K.field}),this._refresh();break;case 39:I.preventDefault(),this.currentSpareIndex=this._calculateNextSpareIndex(this.spares,this.currentSpareIndex,1,function(K){return'Delimiter'!==K.field}),this._refresh();break;case 38:I.preventDefault(),this._crement(1,J);break;case 40:I.preventDefault(),this._crement(-1,J);break;case 46:I.preventDefault(),this.datetime=new Date(NaN),this._refresh();break;case 65:case 67:I.ctrlKey||I.preventDefault();break;default:if(I.preventDefault(),!isFinite(I.key))return;if('AMPM'===J.field)return;if('Weekday'===J.field)return;this._modify(+I.key,J);}},_handleMousewheel:function(I){I.preventDefault(),I.stopPropagation();var J=Math.sign(I.wheelDelta),K=this._ensureValueExist();this._crement(J,K),this._refresh()},_calculateSpareIndexAtCaretPosition:function(I,J){var K=0,L=0,M=0;for(L;L<=J.length-1&&('Delimiter'!==J[L].field&&(M=L),!(K>=I));L++)K+=J[L].length;return M},_calculateNextSpareIndex:function(I,J,K,L){K=Math.sign(K);for(var N=J+K;0<=N&&N<I.length;N+=K)if(L(I[N])){break}return M},_getMaxFieldValueAtDate:function(I,J){var K=I.getFullYear(),L=I.getMonth();switch(J){case'FullYear':return 9999;case'Month':return 12;case'Date':return new Date(K,L+1,0).getDate();case'Hours':return 23;case'Minutes':return 59;case'Seconds':return 59;default:}},_calculateNextValue:function(I,J,K){var L=J.buffer||J.value;'Month'===J.field&&++L;var M=10*L+I,O=[M%1e4,M%1e3,M%100,M%10].reduce(function(S,T){return T<=K?Math.max(S,T):S},0);'Month'===J.field&&(O=O?O-1:L-1),'Date'===J.field&&0===O&&(O=L);var P='setUTC'+J.field,Q=new Date(this.datetime);Q[P](O);var R=this._validate(Q);if(R)return Q;var S=!0,T=new Date(this.options.maxDate)['getUTC'+J.field](),U=new Date(this.options.minDate)['getUTC'+J.field](),V=new Date(this.options.minTime)['getUTC'+J.field](),W=new Date(this.options.maxTime)['getUTC'+J.field](),X=Q['getUTC'+J.field]();return(('FullYear'===J.field||'Month'===J.field||'Date'===J.field)&&(S=!(T<X)&&!(X<U)),('Hours'===J.field||'Minutes'===J.field||'Seconds'===J.field)&&(W>V?S=!((T||W)<X)&&!(X<(V||U)):S=!((T||W)>X)&&!(X>(V||U))),S)?(Q=this._fitToLmits(Q),Q):(J.buffer=10*(J.buffer||0)+I,this.datetime)},_crement:function(I,J){if('Delimiter'!==J.field){var K,L=J.value;'AMPM'===J.field?(K='setUTCHours',L+=12*I):'Weekday'===J.field?(K='setUTCDate',L+=I):(K='setUTC'+J.field,L+=I);var M=new Date(this.datetime);M[K](L);var N=this._fitToLmits(M);N.getTime()!==this.datetime.getTime()&&(this.datetime=N,this._refresh(),this.$element.trigger('change',this.datetime))}},_modify:function(I,J){var K=this._getMaxFieldValueAtDate(this.datetime,J.field),L=this._calculateNextValue(I,J,K);L!==this.datetime&&(this.datetime=L,this._refresh(),this.$element.trigger('change',this.datetime))},_disassembleTimestamp:function(I,J,K){var L=[],M=0;if('Invalid Date'==I)return L;if(I==f)return L;for(var N=K.trim().match(/\w+|\S|\s/g),O=I.getUTCDate(),P=I.getUTCFullYear(),Q=I.getUTCHours(),R=I.getUTCMinutes(),S=I.getUTCMonth(),T=I.getUTCSeconds(),U=I.getTime(),V=0;V<N.length;V++){var W={timeZone:'UTC'},X={},Z=void 0;switch(N[V]){case'yy':W.year='2-digit',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=P,X.field='FullYear';break;case'yyyy':W={year:'numeric',timeZone:'UTC'},X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=P,X.field='FullYear';break;case'M':W.month='2-digit',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=S,X.field='Month';break;case'MM':W.month='short',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=S,X.field='Month';break;case'MMM':W.month='narrow',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=S,X.field='Month';break;case'MMMM':W.month='long',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=S,X.field='Month';break;case'L':W.month='long',W.day='2-digit',X.strval=Intl.DateTimeFormat(J,{day:'2-digit',month:'long'}).format(U).substr(3),X.value=S,X.field='Month';break;case'd':W.day='numeric',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=O,X.field='Date';break;case'dd':W.day='2-digit',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=O,X.field='Date';break;case'EE':W.weekday='short',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=O,X.field='Weekday';break;case'EEE':W.weekday='narrow',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=O,X.field='Weekday';break;case'EEEE':W.weekday='long',X.strval=Intl.DateTimeFormat(J,W).format(U),X.value=O,X.field='Weekday';break;case'h':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:1}).format(Q%12),X.value=Q,X.field='Hours';break;case'hh':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:2}).format(Q%12),X.value=Q,X.field='Hours';break;case'H':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:1}).format(Q),X.value=Q,X.field='Hours';break;case'HH':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:2}).format(Q),X.value=Q,X.field='Hours';break;case'm':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:1}).format(R),X.value=R,X.field='Minutes';break;case'mm':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:2}).format(R),X.value=R,X.field='Minutes';break;case's':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:1}).format(T),X.value=T,X.field='Seconds';break;case'ss':X.strval=Intl.NumberFormat(J,{minimumIntegerDigits:2}).format(T),X.value=T,X.field='Seconds';break;case'a':W.hour='numeric',W.hour12=!0,Z=Intl.DateTimeFormat(J+'-u-nu-latn',W).format(U),X.strval=Z.match(/[^\d\s]+/g)[0],X.value=Q,X.field='AMPM';break;default:X.strval=N[V],X.field='Delimiter';}X.length=X.strval.length,X.offset=M,M+=X.length,L.push(X)}return L},_validate:function(I){var J=I.getTime(),K=(J%E+E)%E,L=J-K,M=!0,N=!0,O=isFinite(this.options.maxDate),P=isFinite(this.options.maxTime),Q=isFinite(this.options.minDate),R=isFinite(this.options.minTime),S=this.options.minTime>this.options.maxTime;return R&&P&&(M=S?this.options.maxTime>=K||K>=this.options.minTime:this.options.maxTime>=K&&K>=this.options.minTime),Q&&!R&&(N=N&&J>=this.options.minDate),O&&!P&&(N=N&&J<=this.options.maxDate),Q&&R&&(N=N&&L>=this.options.minDate),O&&P&&(N=N&&L<=this.options.maxDate),N&&M},_fitToLmits:function(I){if(isNaN(I))return I;var J=I.getTime(),K=(J%E+E)%E,L=J-K;if(!isNaN(this.options.minTime)&&!isNaN(this.options.maxTime)){if(this.options.maxTime>this.options.minTime)K=Math.max(this.options.minTime,Math.min(this.options.maxTime,K));else{var M=Math.abs(K-this.options.maxTime)<Math.abs(K-this.options.minTime)?this.options.maxTime:this.options.minTime;K=K>this.options.minTime||K<this.options.maxTime?K:M}isNaN(this.options.minDate)||(L=Math.max(L,this.options.minDate)),isNaN(this.options.maxDate)||(L=Math.min(L,this.options.maxDate))}else{K=0;var M=isNaN(this.options.minDate)?-Infinity:this.options.minDate,N=isNaN(this.options.maxDate)?Infinity:this.options.maxDate;L=Math.max(M,Math.min(N,J)),isNaN(L)&&(L=J)}return new Date(L+K)},getTime:function(){return this.datetime},setTime:function(I){this.datetime=new Date(I),this._refresh()},setOptions:function(I){this.options=Object.assign({},this.options,I),this.datetime=I.hasOwnProperty('datetime')?new Date(I.datetime):this.datetime;var J=new Date(this.options.minDate).getTime(),K=new Date(this.options.maxDate).getTime(),L=new Date(this.options.minTime).getTime(),M=new Date(this.options.maxTime).getTime();this.options.minTime=(L%E+E)%E,this.options.maxTime=(M%E+E)%E,this.options.minDate=isNaN(L)?J:J-J%E,this.options.maxDate=isNaN(M)?K:K-K%E,isNaN(this.options.minTime)||(this.options.maxTime=isNaN(this.options.maxTime)?E:this.options.maxTime),isNaN(this.options.maxTime)||(this.options.minTime=isNaN(this.options.minTime)?0:this.options.minTime),this._refresh()},destroy:function(){this.element.removeEventListener('mouseup',this._handleMouseDown),this.element.removeEventListener('keydown',this._handleKeydown),this.element.removeEventListener('mousewheel',this._handleMousewheel),a(this.element).removeData(F)}},a.fn[F]=function(H,I){if(!this.data(F))return'string'==typeof H?void console.warn('datetime plugin expect options object as first argument'):(this.data(F,new g(this,H)),this);var J=this.data(F);return'function'==typeof J[H]?J[H](I):void console.warn('method ',H,' not exist')}})(jQuery,window,document)});

//# sourceMappingURL=datetime.stg.js.map