(function(a,b){if('function'==typeof define&&define.amd)define([],b);else if('undefined'!=typeof exports)b();else{b(),a.datetime={exports:{}}.exports}})(this,function(){'use strict';(function(a,b,d,f){function g(I,J){this.$element=I,this.element=I[0],this.currentSpareIndex=0,this.spares=[],this._handleMouseDown=this._handleMouseDown.bind(this),this._handleKeydown=this._handleKeydown.bind(this),this._handleMousewheel=this._handleMousewheel.bind(this),this._init(),this.setOptions(Object.assign({},H,J))}var F=8.64e7,G='datetime',H={datetime:NaN,locale:navigator.language,format:'dd.MM.yyyy HH:mm:ss',minDate:NaN,maxDate:NaN,minTime:NaN,maxTime:NaN,tabControls:!1};g.prototype={_init:function(){this.element.setSelectionRange(0,0),this.element.addEventListener('mouseup',this._handleMouseDown),this.element.addEventListener('keydown',this._handleKeydown),this.element.addEventListener('mousewheel',this._handleMousewheel)},_refresh:function(){this.spares=this._disassembleTimestamp(this.datetime,this.options.locale,this.options.format),this.element.value=this.spares.map(function(K){return K.strval}).join('');var J=this.spares[this.currentSpareIndex];J&&this.element.setSelectionRange(J.offset,J.offset+J.length)},_handleMouseDown:function(J){J.preventDefault(),J.stopPropagation(),this._ensureValueExist(),this.currentSpareIndex=this._calculateSpareIndexAtCaretPosition(J.target.selectionStart,this.spares);var K=this.spares[this.currentSpareIndex];J.target.focus();K&&J.target.setSelectionRange(K.offset,K.offset+K.length)},_ensureValueExist:function(){this.spares.length||(this.datetime=new Date,this._refresh())},_handleKeydown:function(J){var K=this;this._ensureValueExist();var L=this.spares[this.currentSpareIndex],M=-1,N=1,O=function move(P){K.currentSpareIndex=K._calculateNextSpareIndex(K.spares,K.currentSpareIndex,P,function(Q){return'Delimiter'!==Q.field}),K._refresh()};switch(J.which){case 37:J.preventDefault(),O(M);break;case 39:J.preventDefault(),O(N);break;case 38:case 107:J.preventDefault(),this._crement(1,L);break;case 40:case 109:J.preventDefault(),this._crement(-1,L);break;case 46:J.preventDefault(),this.datetime=new Date(NaN),this._refresh();break;case 9:if(this.options.tabControls){var P=this.currentSpareIndex;J.shiftKey?O(M):O(N),P!==this.currentSpareIndex&&J.preventDefault()}break;case 65:case 67:J.ctrlKey||J.preventDefault();break;default:if(J.preventDefault(),!isFinite(J.key))return;if('AMPM'===L.field)return;if('Weekday'===L.field)return;this._modify(+J.key,L);}},_handleMousewheel:function(J){J.preventDefault(),J.stopPropagation(),this._ensureValueExist();var K=this.spares[this.currentSpareIndex],L=Math.sign(J.wheelDelta);this._crement(L,K),this._refresh()},_calculateSpareIndexAtCaretPosition:function(J,K){var L=0,M=K.findIndex(function(N){return'Delimiter'!==N.field});for(M;M<K.length&&('Delimiter'!==K[M].field&&(L=M),!(K[M].offset>=J));M++);return L},_calculateNextSpareIndex:function(J,K,L,M){L=Math.sign(L);var N=K;N/=1;for(var O=K+L;0<=O&&O<J.length;O+=L)if(M(J[O])){N=O;break}return N},_getMaxFieldValueAtDate:function(J,K){var L=J.getFullYear(),M=J.getMonth();switch(K){case'FullYear':return 9999;case'Month':return 12;case'Date':return new Date(L,M+1,0).getDate();case'Hours':return 23;case'Minutes':return 59;case'Seconds':return 59;default:}},_calculateNextValue:function(J,K,L){var M=K.buffer||K.value;'Month'===K.field&&++M;var N=10*M+J,P=[N%1e4,N%1e3,N%100,N%10].reduce(function(T,U){return U<=L?Math.max(T,U):T},0);'Month'===K.field&&(P=P?P-1:M-1),'Date'===K.field&&0===P&&(P=M);var Q='setUTC'+K.field,R=new Date(this.datetime);R[Q](P);var S=this._validate(R);if(S)return R;var T=!0,U=new Date(this.options.maxDate)['getUTC'+K.field](),V=new Date(this.options.minDate)['getUTC'+K.field](),W=new Date(this.options.minTime)['getUTC'+K.field](),X=new Date(this.options.maxTime)['getUTC'+K.field](),Y=R['getUTC'+K.field]();return(('FullYear'===K.field||'Month'===K.field||'Date'===K.field)&&(T=!(U<Y)&&!(Y<V)),('Hours'===K.field||'Minutes'===K.field||'Seconds'===K.field)&&(X>W?T=!((U||X)<Y)&&!(Y<(W||V)):T=!((U||X)>Y)&&!(Y>(W||V))),T)?(R=this._fitToLmits(R),R):(K.buffer=10*(K.buffer||0)+J,this.datetime)},_crement:function(J,K){if('Delimiter'!==K.field){var L,M=K.value;'AMPM'===K.field?(L='setUTCHours',M+=12*J):'Weekday'===K.field?(L='setUTCDate',M+=J):(L='setUTC'+K.field,M+=J);var N=new Date(this.datetime);N[L](M);var O=this._fitToLmits(N);O.getTime()!==this.datetime.getTime()&&(this.datetime=O,this._refresh(),this.$element.trigger('change',this.datetime))}},_modify:function(J,K){var L=this._getMaxFieldValueAtDate(this.datetime,K.field),M=this._calculateNextValue(J,K,L);M!==this.datetime&&(this.datetime=M,this._refresh(),this.$element.trigger('change',this.datetime))},_disassembleTimestamp:function(J,K,L){var M=[],N=0;if('Invalid Date'==J)return M;if(J==f)return M;for(var O=L.trim().match(/\w+|\S|\s/g),P=J.getUTCDate(),Q=J.getUTCFullYear(),R=J.getUTCHours(),S=J.getUTCMinutes(),T=J.getUTCMonth(),U=J.getUTCSeconds(),V=J.getTime(),W=0;W<O.length;W++){var X={timeZone:'UTC'},Y={},_=void 0;switch(O[W]){case'yy':X.year='2-digit',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=Q,Y.field='FullYear';break;case'yyyy':X={year:'numeric',timeZone:'UTC'},Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=Q,Y.field='FullYear';break;case'M':X.month='2-digit',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=T,Y.field='Month';break;case'MM':X.month='short',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=T,Y.field='Month';break;case'MMM':X.month='narrow',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=T,Y.field='Month';break;case'MMMM':X.month='long',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=T,Y.field='Month';break;case'L':X.month='long',X.day='2-digit',Y.strval=Intl.DateTimeFormat(K,{day:'2-digit',month:'long'}).format(V).substr(3),Y.value=T,Y.field='Month';break;case'd':X.day='numeric',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=P,Y.field='Date';break;case'dd':X.day='2-digit',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=P,Y.field='Date';break;case'EE':X.weekday='short',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=P,Y.field='Weekday';break;case'EEE':X.weekday='narrow',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=P,Y.field='Weekday';break;case'EEEE':X.weekday='long',Y.strval=Intl.DateTimeFormat(K,X).format(V),Y.value=P,Y.field='Weekday';break;case'h':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:1}).format(R%12),Y.value=R,Y.field='Hours';break;case'hh':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:2}).format(R%12),Y.value=R,Y.field='Hours';break;case'H':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:1}).format(R),Y.value=R,Y.field='Hours';break;case'HH':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:2}).format(R),Y.value=R,Y.field='Hours';break;case'm':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:1}).format(S),Y.value=S,Y.field='Minutes';break;case'mm':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:2}).format(S),Y.value=S,Y.field='Minutes';break;case's':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:1}).format(U),Y.value=U,Y.field='Seconds';break;case'ss':Y.strval=Intl.NumberFormat(K,{minimumIntegerDigits:2}).format(U),Y.value=U,Y.field='Seconds';break;case'a':X.hour='numeric',X.hour12=!0,_=Intl.DateTimeFormat(K+'-u-nu-latn',X).format(V),Y.strval=_.match(/[^\d\s]+/g)[0],Y.value=R,Y.field='AMPM';break;default:Y.strval=O[W],Y.field='Delimiter';}Y.length=Y.strval.length,Y.offset=N,N+=Y.length,M.push(Y)}return M},_validate:function(J){var K=J.getTime(),L=(K%F+F)%F,M=K-L,N=!0,O=!0,P=isFinite(this.options.maxDate),Q=isFinite(this.options.maxTime),R=isFinite(this.options.minDate),S=isFinite(this.options.minTime),T=this.options.minTime>this.options.maxTime;return S&&Q&&(N=T?this.options.maxTime>=L||L>=this.options.minTime:this.options.maxTime>=L&&L>=this.options.minTime),R&&!S&&(O=O&&K>=this.options.minDate),P&&!Q&&(O=O&&K<=this.options.maxDate),R&&S&&(O=O&&M>=this.options.minDate),P&&Q&&(O=O&&M<=this.options.maxDate),O&&N},_fitToLmits:function(J){if(isNaN(J))return J;var K=J.getTime(),L=(K%F+F)%F,M=K-L;if(!isNaN(this.options.minTime)&&!isNaN(this.options.maxTime)){if(this.options.maxTime>this.options.minTime)L=Math.max(this.options.minTime,Math.min(this.options.maxTime,L));else{var N=Math.abs(L-this.options.maxTime)<Math.abs(L-this.options.minTime)?this.options.maxTime:this.options.minTime;L=L>this.options.minTime||L<this.options.maxTime?L:N}isNaN(this.options.minDate)||(M=Math.max(M,this.options.minDate)),isNaN(this.options.maxDate)||(M=Math.min(M,this.options.maxDate))}else{L=0;var N=isNaN(this.options.minDate)?-Infinity:this.options.minDate,O=isNaN(this.options.maxDate)?Infinity:this.options.maxDate;M=Math.max(N,Math.min(O,K)),isNaN(M)&&(M=K)}return new Date(M+L)},getTime:function(){return this.datetime},setTime:function(J){this.datetime=new Date(J),this._refresh()},setOptions:function(J){this.options=Object.assign({},this.options,J),this.datetime=J.hasOwnProperty('datetime')?new Date(J.datetime):this.datetime;var K=new Date(this.options.minDate).getTime(),L=new Date(this.options.maxDate).getTime(),M=new Date(this.options.minTime).getTime(),N=new Date(this.options.maxTime).getTime();this.options.minTime=(M%F+F)%F,this.options.maxTime=(N%F+F)%F,this.options.minDate=isNaN(M)?K:K-K%F,this.options.maxDate=isNaN(N)?L:L-L%F,isNaN(this.options.minTime)||(this.options.maxTime=isNaN(this.options.maxTime)?F:this.options.maxTime),isNaN(this.options.maxTime)||(this.options.minTime=isNaN(this.options.minTime)?0:this.options.minTime),this._refresh()},destroy:function(){this.element.removeEventListener('mouseup',this._handleMouseDown),this.element.removeEventListener('keydown',this._handleKeydown),this.element.removeEventListener('mousewheel',this._handleMousewheel),a(this.element).removeData(G)}},a.fn[G]=function(I,J){if(!this.data(G))return'string'==typeof I?void console.warn('datetime plugin expect options object as first argument'):(this.data(G,new g(this,I)),this);var K=this.data(G);return'function'==typeof K[I]?K[I](J):void console.warn('method ',I,' not exist')}})(jQuery,window,document)});
